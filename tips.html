<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tips — Yarn + Biome Cheatsheet</title>
  <style>
    body { font-family: Inter, Arial, Helvetica, sans-serif; padding:24px; color:#111 }
    header { border-bottom:1px solid #ddd; margin-bottom:18px }
    nav ul { list-style:none; padding:0; display:flex; gap:12px; flex-wrap:wrap }
    nav a { color:#0366d6; text-decoration:none }
    section { margin-top:18px }
    pre { background:#f6f8fa; padding:12px; overflow:auto }
    code { background:#f1f1f1; padding:2px 6px; border-radius:4px }
    .note { color:#555; font-size:0.95em }
  </style>
</head>
<body>
  <header>
    <h1>Tips — Yarn + Biome + Husky Cheatsheet</h1>
    <nav>
      <ul>
        <li><a href="#cheatsheet">Cheatsheet</a></li>
  <li><a href="#hooks">Husky &amp; Pre-commit</a></li>
  <li><a href="#files">Files &amp; Folders used</a></li>
        <li><a href="#scripts">Useful scripts</a></li>
        <li><a href="#troubleshoot">Troubleshooting</a></li>
        <li><a href="#examples">Examples</a></li>
        <li><a href="#ci">CI</a></li>
        <li><a href="#sublime">Sublime</a></li>
      </ul>
    </nav>
  </header>

  <section id="cheatsheet">
    <h2>Quick cheatsheet</h2>
    <p>Basic workflow commands (run from repo root):</p>
    <pre><code># install dependencies
yarn install

# install husky hooks (runs prepare)
yarn prepare

# run linting (biome)
yarn lint

# auto-format and write changes
yarn format

# start dev server (Vite)
yarn start

# build
yarn build

# run sequential pre-commit locally (no commit)
yarn precommit:seq

# run the husky hook manually
sh .husky/pre-commit
</code></pre>
  </section>

  <section id="hooks">
  <h2>Husky &amp; Pre-commit</h2>
    <p>This repo uses a Husky pre-commit hook to run checks before allowing a commit. Key points:</p>
    <ul>
      <li>Husky hook is at <code>.husky/pre-commit</code>.</li>
      <li>Hook calls the sequential runner: <code>yarn precommit:seq</code> (runs <code>scripts/precommit-seq.js</code>).</li>
      <li>The sequential runner runs checks in order to avoid resource contention: JS/TS (Biome with <code>--unsafe</code> auto-fixes), CSS (<code>stylelint --fix</code>), HTML (<code>htmlhint</code>).</li>
      <li>If a check fails, the commit is aborted and the staged files are restored to their pre-hook state.</li>
    </ul>
    <p class="note">Why sequential? Running checks one-by-one avoids heavy parallel CPU/memory use that previously caused processes to be killed during pre-commit.</p>
  </section>

  <section id="scripts">
    <h2>Scripts to know</h2>
    <ul>
      <li><code>prepare</code> — installs husky hooks (runs automatically on install).</li>
      <li><code>precommit:seq</code> — runs the sequential pre-commit script (invoked by Husky).</li>
      <li><code>lint</code> / <code>format</code> — run Biome to check or write fixes.</li>
    </ul>
  </section>

  <section id="files">
  <h2>Files &amp; folders used by this system</h2>
    <p>Below are files and folders in this project root that are part of the workflow and should be kept around:</p>
    <ul>
      <li><code>package.json</code> — central manifest: scripts, lint-staged config, devDependencies (Biome, Husky, lint-staged, stylelint, htmlhint).</li>
      <li><code>yarn.lock</code> — lockfile for reproducible installs.</li>
      <li><code>.husky/</code> — Husky hooks (pre-commit script lives here).</li>
      <li><code>scripts/precommit-seq.js</code> — sequential pre-commit runner (invoked by Husky).</li>
      <li><code>what_ai_did.html</code> and <code>what_ai_did</code> — activity log and short summary (documentation/artifact of the setup).</li>
      <li><code>README.md</code> — project readme; now includes a "Developer workflow" section.</li>
      <li><code>node_modules/</code> — installed dependencies (generated by <code>yarn install</code>).</li>
      <li><code>.git/</code> — git repo; Husky hooks rely on an active git repository.</li>
    </ul>
    <p class="note">Optional/auxiliary files you can keep but are not strictly required: <code>package1.json</code> / <code>package2.json</code> (left in repo but not used), other HTML/CSS helper files.</p>
  </section>

  <section id="troubleshoot">
  <h2>Troubleshooting &amp; tips</h2>
    <ul>
      <li>If a pre-commit hook fails, inspect the failing tool output. To re-run pre-commit checks without committing: <code>yarn precommit:seq</code>.</li>
      <li>If Husky hooks don't install: run <code>npx husky install</code> or <code>yarn prepare</code> again.</li>
      <li>If lint-staged reports no staged files, make sure you <code>git add</code> files before committing.</li>
      <li>HTML linting uses <code>htmlhint</code> (does not auto-fix). For auto-formatting HTML, consider using <code>prettier --write</code> instead and update <code>package.json</code> lint-staged accordingly.</li>
      <li>To undo changes made by pre-commit (if commit aborted), your working tree is restored automatically by the hook backup; otherwise use <code>git stash pop</code> cautiously.</li>
    </ul>
  </section>

  <section id="examples">
  <h2>Examples &amp; common flows</h2>
    <h3>Quick edit → commit</h3>
    <pre><code># edit files
git add src/file.js
# this will run the husky pre-commit hook which calls the sequential runner
git commit -m "fix: something"

# If the hook auto-fixes files, re-add and commit again:
git add src/file.js
git commit -m "fix: apply biome autofix"
    </code></pre>

    <h3>Run checks manually</h3>
    <pre><code># run all checks locally (format, lint, tests)
yarn format && yarn lint && yarn test

# run only the sequential pre-commit runner (no commit)
yarn precommit:seq
    </code></pre>
  </section>

  <section id="ci">
    <h2>CI example (GitHub Actions)</h2>
    <p>Minimal GitHub Actions workflow to run format/lint/test on PRs and pushes.</p>
    <pre><code>name: CI

on: [push, pull_request]

jobs:
  ci:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18
      - name: Enable corepack
        run: corepack enable
      - name: Install dependencies
        run: yarn install --frozen-lockfile
      - name: Format
        run: yarn format
      - name: Lint
        run: yarn lint
      - name: Test
        run: yarn test
    </code></pre>
    <p class="note">Alternatively, run <code>yarn precommit:seq</code> as a CI step to execute the same sequential checks that run locally on commit.</p>
  </section>

  <section id="sublime">
  <h2>Sublime Text — Copilot &amp; auto-linting</h2>
    <p>Steps to enable Copilot and auto-lint/format on save in Sublime Text:</p>
    <ol>
      <li>Install <strong>Package Control</strong> (if not already).</li>
      <li>Use <code>Package Control: Install Package</code> to install:
        <ul>
          <li><code>GitHub Copilot</code> — Copilot completion in Sublime.</li>
          <li><code>SublimeLinter</code> and <code>SublimeLinter-contrib-stylelint</code> (for CSS linting).</li>
          <li><code>Run on Save</code> — run shell commands when files are saved.</li>
        </ul>
      </li>
      <li>Configure <code>Run on Save</code> to run Biome and stylelint on save. Open <code>Preferences → Package Settings → Run on Save → Settings</code> and add entries like:
        <pre><code>{
  "cmd": ["./node_modules/.bin/biome", "check", "--write", "$file"],
  "match": "\.(js|ts|json|md)$",
  "shell": true
}

{
  "cmd": ["npx", "stylelint", "--fix", "$file"],
  "match": "\.css$",
  "shell": true
}
        </code></pre>
        <p class="note">These run the local project binaries so formatting is consistent with CI. Adjust paths if needed.</p>
      </li>
      <li>Configure SublimeLinter to include <code>./node_modules/.bin</code> in its <code>paths</code> setting so linters find local executables.</li>
      <li>Test: edit a file and save — Biome/stylelint should run and apply fixes automatically. Copilot suggestions appear while typing.</li>
    </ol>
  </section>

  <footer style="margin-top:24px; border-top:1px solid #eee; padding-top:12px; color:#666">Made on 2025-11-02 — quick reference for the Yarn + Biome workflow in this repo.</footer>
</body>
</html>